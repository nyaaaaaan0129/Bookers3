<div class="container">
  <div class="row">
    <%= render 'shared/sidebar' %>
    <div class="col-xs-9">
      <h2>Book detail</h2>

      <div class="book_show">
      <table class="table">
            <thead>
              <th></th>
              <th>Title</th>
              <th>Opinion</th>
            </thead>
            <tbody>
              <tr>
                <td><div class="user-edit-image"><%= attachment_image_tag @book.user, :profile_image, format: 'jpeg', class: "img-square", fallback: "no_image.jpg", size: "60x60" %></div><%= link_to user_path(@book.user) do %><%= @book.user.name %><% end %></td>
                <td><%= @book.title %></td>
                <td><%= @book.body %></td>
                <% if current_user == @book.user %>
                <td><%= link_to "Edit", edit_book_path(@book), class:"btn btn-success" %></td>
                <td><%= link_to "Destroy", book_path(@book), method: :delete, data: {confirm: "削除しますか？"}, class:"btn btn-danger" %></td><% end %>
                <td>
                  <% if @book.favorited_by?(current_user) %>
                <%= link_to book_favorites_path(@book), method: :delete do %>
                <i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
                <%= @book.favorites.count %> いいね
                <% end %>
                <% else %>
                <%= link_to book_favorites_path(@book), method: :post do %>
                <i class="fa fa-heart-o" aria-hidden="true"></i>
                <%= @book.favorites.count %> いいね
                <% end %>
                </td>
                <td><%= @book.book_comments.count %>件のコメント</td>
                <% end %>
              </tr>
            </tbody>
        </table>
      </div>
      <div class="book_comments">
        <table class="table">
            <thead>
              <th></th>
              <th></th>
              <th></th>
              <th>Comments</th>
            </thead>
            <tbody>
              <% @book.book_comments.each do |book_comment| %>
              <tr>
                <td><div class="user-edit-image"><%= attachment_image_tag book_comment.user, :profile_image, format: 'jpeg', class: "img-square", fallback: "no_image.jpg", size: "60x60" %></div><%= link_to user_path(book_comment.user) do %><%= book_comment.user.name %><% end %></td>
                <td><%= book_comment.created_at.strftime('%Y/%m/%d') %></td>
                <td><%= book_comment.comment %></td>
                <% if book_comment.user == current_user %>
                <td>
                <%= link_to "削除", book_book_comment_path(book_comment.book, book_comment), method: :delete, class: "btn btn-danger pull-right" %>
                </td>
                <% end %>
                <% end %>
              </tr>
            </tbody>
        </table>
      </div>
      <div class="comment_form">
        <%= render "shared/comment_error" %>
        <%= form_for [@book, @book_comment] do |f| %>
          <div class="row">
            <div class="col-sm-12">
              <%= f.text_area :comment, rows:'5', class: "form-control",placeholder: "コメントをここに" %>
            </div>
          </div>
          <%= f.submit "送信する", class: "btn btn-lg btn-base-1 mt-20 pull-right" %>
          <% end %>
      </div>
    </div>
  </div>
</div>